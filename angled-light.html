<!DOCTYPE html>
<html>
<head>
<title>Patrick's light</title>
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" charset="utf-8"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>

function readParticleVariable(variableName,resultFunction) {
	  var deviceID    = "38003b001347363336383437";
      var accessToken = "82a528ad4ec2c1d91f74d4155e4ce1e8e41cebd2";

      requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/" + variableName
	  var formData = {
		'access_token':accessToken, 
	  }

      $.post(requestURL, formData, function(json) {
			console.log(json)
			resultFunction(json.result);
			});
}

function callParticleFunction(functionName,argValue) {
	  var deviceID    = "38003b001347363336383437";
      var accessToken = "82a528ad4ec2c1d91f74d4155e4ce1e8e41cebd2";

      requestURL = "https://api.spark.io/v1/devices/" + deviceID + "/" + functionName
	  var formData = {
		'access_token':accessToken, 
		'arg':argValue
	  }

      $.post(requestURL, formData, function(json) {
			console.log(json)
			});
}

var colorWell;
var whiteSlider;
var partyMode;
var naturalMode;

var defaultColor = "#000000";

function setup() {
	// TODO: read the values
	// TODO: change mode to be a single drop down and show/hide color picker
	// TODO: In color mode, make white 0 by default.
	// TODO: Alexa
	// TODO: More fun modes
	//   readParticleVariable(variableName,function { console.log("this is the value")});

	// setup the color picker
	colorWell = document.querySelector("#colorWell");
	colorWell.value = defaultColor;
	colorWell.addEventListener("change", updateColor, false);
	colorWell.select();

	// setup the white slider
	whiteSlider= document.querySelector("#white");
	whiteSlider.addEventListener("change", updateWhite, false);

	// setup the party mode checkbox
	partyMode= document.querySelector("#partymode");
	partyMode.addEventListener("change", updatePartyMode, false);

	// setup the natural mode checkbox
	naturalMode= document.querySelector("#naturalmode");
	naturalMode.addEventListener("change", updateNaturalMode, false);

	// TODO: test out defaults and disabled or slow wifi
}

function updateColor(event) {
	colorValue = event.target.value;
	document.querySelector("#colorText").textContent = colorValue + " " + JSON.stringify(hexToRgb(colorValue));
	callParticleFunction("rgb_value",event.target.value);
}

function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? [
        parseInt(result[1], 16),
        parseInt(result[2], 16),
        parseInt(result[3], 16)
    ] : null;
}

function updateWhite(event) {
	callParticleFunction("w_value",event.target.value);
}

function updatePartyMode(event) {
	callParticleFunction("party_mode",partyMode.checked);
}

function updateNaturalMode(event) {
	callParticleFunction("natural_mode",naturalMode.checked);
}
</script>
</head>

<body onload="setup();">
	<h2>Patrick's Angled Light</h2>

	<label for="colorWell">Color</label>
	<input id="colorWell" type="color" value="#ff0000">	
	<span id="colorText"></span>

	<br>

	<label for="white">White</label>
	<input type="range" id="white" name="white" min="0" max="255">
    
	<br>

	<label for="partymode">Party Mode</label>
	<input id= "partymode" type="checkbox" name="partymode" value="true">

	<br>

	<label for="naturalmode">Natural Mode</label>
	<input id= "naturalmode" type="checkbox" name="naturalmode" value="true">

</body>
</html>
